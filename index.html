<script>
  const gallery = document.getElementById('gallery');
  const modal = document.getElementById('imageModal');
  const modalImg = document.getElementById('modalImage');
  const modalVideo = document.getElementById('modalVideo');
  const downloadBtn = document.getElementById('downloadBtn');
  const bgMusic = document.getElementById('bgMusic');
  let images = [], currentIndex = 0;

  // Catbox video links
  const externalVideos = [
    "https://files.catbox.moe/wluvpx.mp4"
    // Add more Catbox links here if needed
  ];

  externalVideos.forEach((url, i) => {
    const vid = document.createElement('video');
    vid.src = url;
    vid.muted = true;
    vid.loop = true;
    vid.autoplay = true;
    vid.playsInline = true;
    vid.style.opacity = '0';
    vid.style.height = '200px';
    vid.style.borderRadius = '12px';
    vid.style.cursor = 'pointer';
    vid.style.objectFit = 'cover';
    vid.style.transition = 'all 0.4s ease';
    vid.style.boxShadow = '0 0 12px rgba(255, 255, 255, 0.1)';
    vid.onloadeddata = () => {
      vid.style.opacity = '1';
      vid.style.transform = 'translateY(0)';
    };
    vid.onclick = () => {
      currentIndex = gallery.children.length;
      openModal(url, true);
    };
    gallery.appendChild(vid);
  });

  function openModal(src, isVideo) {
    modal.style.display = 'flex';
    setTimeout(() => modal.classList.add('show'), 10);
    if (isVideo) {
      modalImg.style.display = 'none';
      modalVideo.style.display = 'block';
      modalVideo.src = src;
      modalVideo.play();
      downloadBtn.href = src;
    } else {
      modalImg.style.display = 'block';
      modalImg.src = src;
      modalVideo.style.display = 'none';
      modalVideo.pause();
      downloadBtn.href = src;
    }
  }

  function closeModal() {
    modal.classList.remove('show');
    setTimeout(() => {
      modal.style.display = 'none';
      modalImg.src = '';
      modalVideo.pause();
      modalVideo.src = '';
    }, 300);
  }

  function navigateModal(direction) {
    currentIndex = (currentIndex + direction + images.length) % images.length;
    const element = images[currentIndex];
    const isVideo = element.tagName.toLowerCase() === 'video';
    openModal(element.src, isVideo);
  }

  const canvas = document.getElementById('particles');
  const ctx = canvas.getContext('2d');
  let w, h, particles = [];
  function resizeCanvas() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
  }
  function createParticles() {
    particles = Array.from({length: 80}, () => ({
      x: Math.random() * w,
      y: Math.random() * h,
      r: Math.random() * 2 + 1,
      dx: (Math.random() - 0.5) * 0.5,
      dy: (Math.random() - 0.5) * 0.5
    }));
  }
  function drawParticles() {
    ctx.clearRect(0, 0, w, h);
    ctx.fillStyle = '#0ff';
    particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fill();
      p.x += p.dx;
      p.y += p.dy;
      if (p.x < 0 || p.x > w) p.dx *= -1;
      if (p.y < 0 || p.y > h) p.dy *= -1;
    });
    requestAnimationFrame(drawParticles);
  }
  window.addEventListener('resize', () => { resizeCanvas(); createParticles(); });
  window.addEventListener('click', () => { if (bgMusic.paused) bgMusic.play().catch(() => {}); }, { once: true });
  resizeCanvas(); createParticles(); drawParticles();
</script>
